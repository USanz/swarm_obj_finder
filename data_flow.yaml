flow: swarm_obj_finder

vars:
  BASE_DIR_PATH: file:///home/usanz/zs_t3/t3_ws/src/swarm_obj_finder



sources:
  - id : tfs_source
    configuration:
      TF1: rt/robot1/tf
      TF2: rt/robot2/tf
    descriptor : "builtin://zenoh"

  - id : imgs_source
    configuration:
      Image1: rt/robot1/camera/image_raw
      Image2: rt/robot2/camera/image_raw
    descriptor : "builtin://zenoh"

operators:
  - id : paths_planner_op
    descriptor : "{{ BASE_DIR_PATH }}/config/nodes_cfg/paths_planner_op.yaml"

  - id : navigator_op
    descriptor : "{{ BASE_DIR_PATH }}/config/nodes_cfg/navigator_op.yaml"

  - id : obj_detector_op
    descriptor : "{{ BASE_DIR_PATH }}/config/nodes_cfg/obj_detector_op.yaml"

  - id : obj_pos_infer_op
    descriptor : "{{ BASE_DIR_PATH }}/config/nodes_cfg/obj_pos_infer_op.yaml"

sinks:
  - id : debug_sink
    configuration:
      DebugMapDiv: rt/debug/map_div_img # no namespaces (global topic /debug/map_div_img in ROS2)
      DebugMarkers: rt/debug/markers    # no namespaces (global topic /debug/markers in ROS2)
      DebugImgFiltered1: rt/robot1/debug/filter_img
      DebugImgFiltered2: rt/robot1/debug/filter_img
    descriptor : "builtin://zenoh"
    
  - id : goal_pose_sink
    configuration:
      Waypoint1: rt/robot1/goal_pose
      Waypoint2: rt/robot2/goal_pose
    descriptor : "builtin://zenoh"



links:
- from:
    node : imgs_source
    output : Image1
  to:
    node : obj_detector_op
    input : Image1
- from:
    node : imgs_source
    output : Image2
  to:
    node : obj_detector_op
    input : Image2

- from:
    node : obj_detector_op
    output : ObjDetected
  to:
    node : obj_pos_infer_op
    input : ObjDetected
- from:
    node : obj_detector_op
    output : DebugImgFiltered1
  to:
    node : debug_sink
    input : DebugImgFiltered1
- from:
    node : obj_detector_op
    output : DebugImgFiltered2
  to:
    node : debug_sink
    input : DebugImgFiltered2

- from:
    node : obj_pos_infer_op
    output : WorldPosition
  to:
    node : navigator_op
    input : WorldPosition


- from:
    node : navigator_op
    output : WPRequest
  to:
    node : paths_planner_op
    input : WPRequest
- from:
    node : paths_planner_op
    output : NextWP
  to:
    node : navigator_op
    input : NextWP


- from:
    node : tfs_source
    output : TF1
  to:
    node : navigator_op
    input : TF1
- from:
    node : tfs_source
    output : TF2
  to:
    node : navigator_op
    input : TF2


- from:
    node : paths_planner_op
    output : DebugMarkers
  to:
    node : debug_sink
    input : DebugMarkers

- from:
    node : paths_planner_op
    output : DebugMapDiv
  to:
    node : debug_sink
    input : DebugMapDiv


- from:
    node : navigator_op
    output : Waypoint1
  to:
    node : goal_pose_sink
    input : Waypoint1
- from:
    node : navigator_op
    output : Waypoint2
  to:
    node : goal_pose_sink
    input : Waypoint2



mapping:
  paths_planner_op: computer
  navigator_op: computer
  obj_detector_op: computer
  obj_pos_infer_op: computer
